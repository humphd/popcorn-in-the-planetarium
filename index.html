<!DOCTYPE html>
<html>
  <head>
    <script type="text/javascript" src="lib/jquery.js"></script>
    <script type="text/javascript" src="lib/jquery-ui.js"></script>
    <script type="text/javascript" src="lib/popcorn.js"></script>
    <script type="text/javascript" src="lib/popcorn.youtube.js"></script>
    <script type="text/javascript" src="lib/popcorn.footnote.js"></script>
    <script type="text/javascript" src="lib/popcorn.code.js"></script>
    <style>

      html, body {
        width: 100%;
        height: 100%;
        padding: 0;
        margin: 0;
        overflow: hidden;
      }

      #div-khan-video {
        position: absolute;
        bottom: 0px;
        right: 0px;
        z-index: 5000;
        border: 2px solid #fff;
        border-radius: 15px;
        opacity: 0.5;
      }

      #iframe-planetarium {
        width: 100%;
        height: 100%;
      }

    </style>
    <script type="text/javascript">

      $(document).ready( function (e) {
        var $iframePlanetarium = $('#iframe-planetarium');
        var $divKhanVideo = $('#div-khan-video');

        function planetariumLoaded (event) {

          if (event.data === 'loaded') {

            var planets = {'space': $iframePlanetarium.contents().find('#back')[0]};
            planets.click = function(planet) {
              var p = this[planet];
              if (!p) {
                return;
              }

              var e = document.createEvent('MouseEvents');
              e.initEvent('click', true, true);
              p.dispatchEvent(e);
            };
            planets.zoomOut = function() {
              this.click('space');
            };

            var planetariumWin = $iframePlanetarium[0].contentWindow;
            planetariumWin.postMessage('start_demo', '*');

            window.removeEventListener('message', planetariumLoaded, false);

            var $planetLinks = $iframePlanetarium.contents().find('li.planet');
            for (var i=0; i<$planetLinks.length; ++i) {
              var li = $planetLinks[i];
              planets[li.id] = li;
            } //for

            var popcorn = Popcorn( Popcorn.youtube('div-khan-video',
                                                   'http://www.youtube.com/watch?v=GP53b__h4ew') );

            popcorn.code({
              start: 89,
              end: 96,
              onStart: function (options) {
                planets.click('mercury');
              },
              onEnd: function(options) {
                planets.zoomOut();
              }
            })

            .code({
              start: 98,
              end: 115,
              onStart: function (options) {
                planets.click('venus');
              },
              onEnd: function(options) {
                planets.zoomOut();
              }
            })

            .code({
              start: 117,
              end: 120,
              onStart: function (options) {
                planets.click('mars');
              },
              onEnd: function(options) {
                planets.zoomOut();
              }
            })

            .code({
              start: 121,
              end: 157,
              onStart: function (options) {
                planets.click('jupiter');
              },
              onEnd: function(options) {
                planets.zoomOut();
              }
            })

            .code({
              start: 160,
              end: 218,
              onStart: function (options) {
                planets.click('saturn');
              },
              onEnd: function(options) {
                planets.zoomOut();
              }
            })

            .code({
              start: 222,
              end: 230,
              onStart: function (options) {
                planets.click('uranus');
              },
              onEnd: function(options) {
                planets.zoomOut();
              }
            })

            .code({
              start: 232,
              end: 260,
              onStart: function (options) {
                planets.click('neptune');
              },
              onEnd: function(options) {
                planets.zoomOut();
              }
            });

          } //if

        } //planetariumLoaded

        window.addEventListener('message', planetariumLoaded, false);

      }); //ready block
    </script>
  </head>
  <body>
    <iframe id="iframe-planetarium" width="100%" height="100%" src="planetarium/demo.html" frameborder="0"></iframe>
    <div id="div-khan-video"></div>
  </body>
</html>
